<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultrag.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/basic}">


<!-- í˜„ì¬ í˜ì´ì§€ì—ì„œë§Œ ì‚¬ìš©í•˜ëŠ” ì»¨í…ì¸ (ë‚´ìš©) ì •ì˜ -->
<div layout:fragment="content">
    <div class="card">
        <div class="card-header">
            board modify
        </div>
        <div>[[${dto}]]</div>

        <!-- ê²Œì‹œê¸€ ë¦¬ìŠ¤íŠ¸ -->
        <div class="card-body">
            <!-- BoardDTO(bno, title, content, writer, email, regDate, modDate) -->
            <!-- ìë™ ë§¤í•‘ ì¡°ê±´ íŒŒë¼ë¯¸í„° ê°’ì´ ë¶ˆëŸ¬ì˜¬ dtoê°’ì´ë‘ ë™ì¼ í•  ë•Œ -->
            <form id="modifyForm">  <!-- action="/board/modify" th:action="@{/board/modify}" method="post" id="f1" -->

                <div class="mb-3 row">
                    <label for="bno" class="col-form-label ps-4">bno</label>
                    <div class="col">
                        <input type="text" class="form-control" id="bno" name="bno"
                               th:value="${dto.bno}" readonly>
                    </div>
                </div>

                <div class="mb-3 row">
                    <label for="title" class="col-form-label ps-4">title</label>
                    <div class="col">
                        <input type="text" class="form-control" id="title" name="title"
                               th:value="${dto.title}">
                    </div>
                </div>

                <div class="mb-3 row">
                    <label for="content" class="col-form-label ps-4">content</label>
                    <div class="col">
                        <textarea class="form-control" id="content" name="content"
                                  th:text="${dto.content}"></textarea>
                    </div>
                </div>

                <div class="mb-3 row">
                    <label for="writer" class="col-form-label ps-4">writer</label>
                    <div class="col">
                        <input type="text" class="form-control" id="writer" name="writer"
                               th:value="${dto.writer}" readonly>
                    </div>
                </div>

                <!-- í˜„ì¬ ë¡œê·¸ì¸ ì‚¬ìš©ìì™€ ê²Œì‹œê¸€ ì‘ì„±ìê°€ ë™ì¼í•œì§€ íŒë³„í•˜ê¸° ìœ„í•œ í•­ëª© -->
                <div class="mb-3 row">
                    <label for="writerId" class="col-form-label ps-4">ID</label>
                    <div class="col">
                        <input type="text" class="form-control" id="writerId" name="writerId" readonly
                               th:value="${dto.writerId}">
                    </div>
                </div>

                <!-- 4. ê²Œì‹œê¸€ ë“±ë¡ì¼, ìˆ˜ì •ì¼ -->
                <div class="mb-3 row" id="regDateBox">
                    <label for="regDate" class="col-form-label ps-4">regDate</label>
                    <div class="col">
                        <input type="text" class="form-control" id="regDate" name="regDate"
                               th:value="${dto.regDate}" readonly>
                    </div>
                </div>

                <div class="mb-3 row" id="modDateBox">
                    <label for="modDate" class="col-form-label ps-4">modDate</label>
                    <div class="col">
                        <input type="text" class="form-control" id="modDate" name="modDate"
                               th:value="${dto.modDate}" readonly>
                    </div>
                </div>

                <!-- 5. list, modify ë²„íŠ¼ -->
                <div class="mt-3 d-flex" th:with="link=${pageRequestDTO.getLink()}">
                    <div><button type="button" id="list" class="btn btn-outline-secondary opacity-50 listBtn">list</button></div>
                    <!-- í˜„ ê¸€ë²ˆí˜¸ì— ëŒ€í•œ í˜ì´ì§• ì •ë³´ë¥¼ ë„˜ê²¨ë°›ì•„ì„œ listìš”ì²­ì‹œ í˜ì´ì§• ì •ë³´ì™€ ê°™ì´ ìš”ì²­í•˜ë©´
                         í˜„ì¬ ê¸€ë²ˆí˜¸ê°€ í•´ë‹¹ë˜ëŠ” listí˜ì´ì§€ê°€ ì¶”ì¶œë¨ -->
                    <div class="ms-auto">
                        <button type="button" class="btn btn-outline-danger opacity-50 removeBtn">Remove</button>
                        <button type="button" class="btn btn-outline-warning opacity-50 cancelBtn">cancel</button>
                        <button type="button" class="btn btn-outline-success opacity-50 confirmBtn">confirm</button>
                    </div>

                </div>
            </form>
        </div>

    </div>

</div>



<!-- í˜„ì¬ í˜ì´ì§€ì—ì„œë§Œ ì‚¬ìš©í•˜ëŠ” css ì •ì˜ -->
<style layout:fragment="mystyle" th:inline="css">
    #content{
        height:500px;
    }
    .col-form-label {
        width:110px;
    }
</style>

<!--/* í˜„ì¬ í˜ì´ì§€ì—ì„œë§Œ ì‚¬ìš©í•˜ëŠ” script ì •ì˜ */-->
<script layout:fragment="myscript" th:inline="javascript">

    // ë¦¬ìŠ¤íŠ¸ ë²„íŠ¼
    document.querySelector('.listBtn').addEventListener('click', function(e) {
        e.preventDefault();  // ê¸°ë³¸ ì´ë²¤íŠ¸ ì œê±°
        e.stopPropagation();  // ë²„ë¸”ë§(í˜„ì¬ ì´ë²¤íŠ¸ê°€ ë°œìƒí•œ ìš”ì†Œì˜ ìƒìœ„ ìš”ì†Œë“¤ì— ëŒ€í•´ì„œ ì´ë²¤íŠ¸ ê°ì§€ë˜ëŠ” í˜„ìƒ) ë°©ì§€

        location.href ="/board/list?"+[[${pageRequestDTO.getLink()}]];
    })

    // ì·¨ì†Œ ë²„íŠ¼
    document.querySelector('.cancelBtn').addEventListener('click', function(e) {
        e.preventDefault();  // ê¸°ë³¸ ì´ë²¤íŠ¸ ì œê±°
        e.stopPropagation();  // ë²„ë¸”ë§(í˜„ì¬ ì´ë²¤íŠ¸ê°€ ë°œìƒí•œ ìš”ì†Œì˜ ìƒìœ„ ìš”ì†Œë“¤ì— ëŒ€í•´ì„œ ì´ë²¤íŠ¸ ê°ì§€ë˜ëŠ” í˜„ìƒ) ë°©ì§€

        location.href ="/board/read?bno="+[[${dto.bno}]]+"&"+[[${pageRequestDTO.getLink()}]];
    })


    // 3. Remove ë²„íŠ¼ ê¸°ëŠ¥ ì²˜ë¦¬
    // const delFiles = document.querySelector('.delImageFileNames');
    document.querySelector('.removeBtn').addEventListener('click', function(e) {
        e.stopPropagation();
        e.preventDefault(); // ê¸°ë³¸ ê¸°ëŠ¥ ì œê±°

        let doubleChk = confirm('ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?');
        if (doubleChk) {

            // javascriptì—ì„œ action, method ì†ì„± ë³€ê²½
            const formObj = document.querySelector('#modifyForm');
            formObj.action = `/board/remove`
            formObj.method = 'post';
            formObj.submit();

        }

    });

    // -------- //
    // ìˆ˜ì • ë²„íŠ¼
    // -------- //

    document.querySelector('.confirmBtn').addEventListener('click', function(e) {
        e.preventDefault();  // ê¸°ë³¸ ì´ë²¤íŠ¸ ì œê±°
        e.stopPropagation();  // ë²„ë¸”ë§(í˜„ì¬ ì´ë²¤íŠ¸ê°€ ë°œìƒí•œ ìš”ì†Œì˜ ìƒìœ„ ìš”ì†Œë“¤ì— ëŒ€í•´ì„œ ì´ë²¤íŠ¸ ê°ì§€ë˜ëŠ” í˜„ìƒ) ë°©ì§€

        const link = [[${pageRequestDTO.getLink()}]];
        // const formObj = document.querySelector('form');  // form ì´ëŸ°ì‹ìœ¼ë¡œ íƒœê·¸ë¥¼ ì§ì ‘ ì°ìœ¼ë©´ ë‚˜ì¤‘ì— ì¶”ê°€, ìˆ˜ì • ì‘ì—…ì„ í•˜ë©´ì„œ ì¤‘ë³µë˜ì„œ ì˜¤ë¥˜ë‚  ê°€ëŠ¥ì„± ë†’ìŒ. ë¹„ì¶”ì²œ
        const formObj = document.querySelector('#modifyForm');
        const title = document.querySelector('#title');
        const content = document.querySelector('#content');
        const writer = document.querySelector('#writer');
        console.log("formObj", formObj);
        console.log(title.value);

        // ì„œë²„ë¡œ ë¶€í„° ì‘ë‹µë°›ì€ ë©”ì‹œì§€: dbì²˜ë¦¬í•œ í›„ ê²°ê³¼ ê°’ ì „ì†¡í•œ ê°ì²´
        const errors = [[${errors}]];
        console.log('errors',errors);

        let errMessage="";
        if (errors) {  // ì„œë²„ë¡œë¶€í„° ì‘ë‹µ ì—ëŸ¬ ë©”ì‹œì§€ ì²˜ë¦¬
            for (let i=0; i<errors.length; i++) {
                errMessage += `${errors[i].field}ì€ ${errors[i].code}\n`;

            }
            // ì›¹ë¸Œë¼ìš°ì €ì˜ ì„¸ì…˜ ê¸°ë¡ì„ ê´€ë¦¬í•˜ëŠ” JavaScriptì˜ History APIë©”ì„œë“œ
            // ë¸Œë¼ìš°ì €ì˜ ì„¸ì…˜ ê¸°ë¡ì„ ìˆ˜ì •í•˜ê±° ëŒ€ì²´í•˜ëŠ” ì—­í• 
            // history.replaceState({},null, null);

            alert(errMessage);
        }

        // ì—ëŸ¬ ì²´í¬

        if ((title.value.length < 1 || title.value == "")&&(content.value.length < 1 || content.value == "")) {
            alert("ì œëª©ê³¼ ë‚´ìš©ì´ ë¹„ì–´ìˆìŠµë‹ˆë‹¤!! ğŸ˜¡ğŸ˜¡");
            return;

        } else if (title.value.length < 1 || title.value == "") {
            alert("ì œëª©ì´ ë¹„ì–´ìˆìŠµë‹ˆë‹¤! ğŸ˜¡");
            return;

        } else if (content.value.length < 1 || content.value == "") {
            alert("ë‚´ìš©ì´ ë¹„ì–´ìˆìŠµë‹ˆë‹¤! ğŸ˜¡");
            return;

        }

        if (title.value.length < 3 || title.value.length > 100) {
            alert("3ì ì´ìƒ 100ì ì´ë‚´ì— ì œëª©ì„ ì¨ì£¼ì„¸ìš”~ :b");
            title.focus();
            return;

        }

        if (content.value.length < 3 || content.value.length > 1000) {
            alert("3ì ì´ìƒ 1000ì ì´ë‚´ì— ê¸€ì„ ì¨ì£¼ì„¸ìš”~ :b");
            content.focus();
            return;

        }

        // ì—ëŸ¬ ì²´í¬ í›„ ì •ìƒì¼ë•Œ ì²˜ë¦¬

        // self .location= `board/modify?${link}`;  // Getë°©ì‹(ìˆ˜ì •í˜ì´ì§€ ìš”ì²­)

        formObj.action = `/board/modify?${link}`;  // ì „ì†¡í•  ë§í¬ ì„¤ì •
        formObj.method = 'post';  // ì „ì†¡ ë°©ì‹ ì„¤ì •  // ì„¤ì • ì•ˆí•˜ë©´ ê¸°ë³¸ê°’ Get

        //const modDateBox = document.querySelector('#modDateBox');
        //modDateBox.innerHTML = '<>';

        // submit() : í¼ ì „ì†¡ ê¸°ëŠ¥   reset() : í¼ ë¦¬ì…‹ ê¸°ëŠ¥
        // html íƒœê·¸ì˜ id ì´ë¦„ì„ submit, reset ì´ëŸ° ê¸°ëŠ¥ìˆëŠ” ì• ë“¤ë¡œ ì£¼ë©´ í•´ë‹¹ ê¸°ëŠ¥ì´ ë™ì‘ ì•ˆí•¨
        // id="submit"ìœ¼ë¡œ ë²„íŠ¼ì— IDë¥¼ ì„¤ì •í•˜ë©´, ê¸°ë³¸ì ìœ¼ë¡œ document ê°ì²´ì—ì„œ submit() ë©”ì„œë“œë¥¼ ë®ì–´ì“°ê²Œ ë©ë‹ˆë‹¤. ì´ ë•Œë¬¸ì— submit() ë©”ì„œë“œë¥¼ í˜¸ì¶œí•´ë„ í•´ë‹¹ ë©”ì„œë“œê°€ ì•„ë‹ˆë¼ ë²„íŠ¼ ìš”ì†Œë¥¼ ì°¸ì¡°í•˜ê²Œ ë˜ì–´ í¼ì´ ì œì¶œë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.

        //console.log([[${dto}]]);
        formObj.submit();  // ì „ì†¡

    })


</script>

</html>

<!--

  ì‚¬ìš©ëª©ì  ìš”ì•½

    - í˜„ì¬ í˜ì´ì§€ì˜ URLì„ ìƒˆë¡œìš´ URLë¡œ ë³€ê²½
    - ì´ì— ë”°ë¼ í˜ì´ì§€ì˜ ìƒíƒœ ì •ë³´ë„ ì—…ë°ì´íŠ¸
    - ì‹¤ì œë¡œ í˜ì´ì§€ì˜ ë¦¬ë¡œë“œë‚˜ ë„¤íŠ¸ì›Œí¬ ìš”ì²­ì€ ë°œìƒí•˜ì§€ ì•ŠìŒ
    - ì‚¬ìš©ì ê²½í—˜ì„ ê°œì„ í•˜ë©´ì„œë„ í˜ì´ì§€ ê°„ ì „í™˜ì´ë‚˜ ìƒíƒœ ê´€ë¦¬ë¥¼ ììœ ë¡­ê²Œ ì œì–´

    ex(
    // í˜„ì¬ URL: http://example.com/page1
    const newState = { data: 'some data' };
    // í˜„ì¬ URLê³¼ ìƒíƒœë¥¼ ìƒˆë¡œìš´ URLê³¼ ìƒíƒœë¡œ ë³€ê²½
    history.replaceState(newState, '', 'http://example.com/page2');

-->