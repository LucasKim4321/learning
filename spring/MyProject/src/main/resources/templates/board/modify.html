<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultrag.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/basic}">


<!-- í˜„ì¬ í˜ì´ì§€ì—ì„œë§Œ ì‚¬ìš©í•˜ëŠ” ì»¨í…ì¸ (ë‚´ìš©) ì •ì˜ -->
<div layout:fragment="content">
    <div class="card">
        <div class="card-header">
            board modify
        </div>
        <div>[[${dto}]]</div>

        <!-- ê²Œì‹œê¸€ ë¦¬ìŠ¤íŠ¸ -->
        <div class="card-body">
            <!-- BoardDTO(bno, title, content, writer, email, regDate, modDate) -->
            <!-- ìë™ ë§¤í•‘ ì¡°ê±´ íŒŒë¼ë¯¸í„° ê°’ì´ ë¶ˆëŸ¬ì˜¬ dtoê°’ì´ë‘ ë™ì¼ í•  ë•Œ -->
            <form id="modifyForm">  <!-- action="/board/modify" th:action="@{/board/modify}" method="post" id="f1" -->

                <div class="mb-3 row">
                    <label for="bno" class="col-form-label ps-4">bno</label>
                    <div class="col">
                        <input type="text" class="form-control" id="bno" name="bno"
                               th:value="${dto.bno}" readonly>
                    </div>
                </div>

                <div class="mb-3 row">
                    <label for="title" class="col-form-label ps-4">title</label>
                    <div class="col">
                        <input type="text" class="form-control" id="title" name="title"
                               th:value="${dto.title}">
                    </div>
                </div>

                <div class="mb-3 row">
                    <label for="content" class="col-form-label ps-4">content</label>
                    <div class="col">
                        <textarea class="form-control" id="content" name="content"
                                  th:text="${dto.content}"></textarea>
                    </div>
                </div>

                <div class="mb-3 row">
                    <label for="writer" class="col-form-label ps-4">writer</label>
                    <div class="col">
                        <input type="text" class="form-control" id="writer" name="writer"
                               th:value="${dto.writer}" readonly>
                    </div>
                </div>

                <!-- í˜„ì¬ ë¡œê·¸ì¸ ì‚¬ìš©ìì™€ ê²Œì‹œê¸€ ì‘ì„±ìê°€ ë™ì¼í•œì§€ íŒë³„í•˜ê¸° ìœ„í•œ í•­ëª© -->
                <div class="mb-3 row" hidden>
                    <label for="email" class="col-form-label ps-4">email</label>
                    <div class="col">
                        <input type="text" class="form-control" id="email" name="email" readonly
                               th:value="${dto.email}">
                    </div>
                </div>

                <!-- ì²¨ë¶€íŒŒì¼ ë“±ë¡ ëª¨ë‹¬ ë²„íŠ¼ -->
                <div class="mb-3 row">
                    <label for="addFilesBtn" class="col-form-label ps-4">image</label>
                    <div class="col d-flex">
                        <div><input type="button" id="addFilesBtn" class="btn btn-secondary opacity-50 addFilesBtn" value="AddImage"></div>
                        <div class="col container-fluid d-flex uploadResult" style="flex-wrap:wrap">
                            <!-- ì´ë¯¸ì§€ ì²¨ë¶€íŒŒì¼ -->
                            <div class="col container-fluid d-flex gap-3 uploadResult" style="flex-wrap:wrap" th:if="${dto.fileNames != null && dto.fileNames.size() > 0 }">
                                <th:block th:each="fileName: ${dto.fileNames}">
                                <div class="card" style="width: 18rem;"
                                     th:with="nameArr=${fileName.split('_')}">  <!-- nameArr [0]uuid [1]fileName -->
                                    <div class="card-header d-flex justify-content-center">
                                        <p>[[${nameArr[1]}]]</p>
                                        <p hidden>${nameArr[1]}</p>  <!-- ê·¸ëƒ¥ í…ìŠ¤íŠ¸ë¡œ ì¸ì‹ -->
                                        <!--/* ì´ ë²„íŠ¼ì˜ ê²½ìš° [[${}]] ${} ë‘˜ ë‹¤ ì˜ë¨. thë„ ìƒê´€ì—†ìŒ. ì¸ìë¡œ ë„˜ì–´ê°„ í›„ ìŠ¤í¬ë¦½íŠ¸ì—ì„  íƒ€ì„ë¦¬í”„ê°€ ì ìš©ë˜ì„œ ê·¸ëŸ¬ë‚˜? */-->
                                        <button type="button" class="btn btn-outline-danger opacity-50" style="margin-left:auto"
                                                onClick="javascript:removeFile('[[${nameArr[0]}]]', '${nameArr[1]}', this)" > x </button>
                                    </div>
                                    <div class="card-body">
                                        <img style="" class="w-100" data-src="${fileName}"
                                             th:src="|/view/${fileName}|" />
                                    </div>
                                </div>
                                </th:block>
                            </div>
                        </div>
                        <div class="uploadHidden"></div>
                    </div>
                </div>

                <!-- 4. ê²Œì‹œê¸€ ë“±ë¡ì¼, ìˆ˜ì •ì¼ -->
                <div class="mb-3 row" id="regDateBox">
                    <label for="regDate" class="col-form-label ps-4">regDate</label>
                    <div class="col">
                        <input type="text" class="form-control" id="regDate" name="regDate"
                               th:value="${dto.regDate}" readonly>
                    </div>
                </div>

                <div class="mb-3 row" id="modDateBox">
                    <label for="modDate" class="col-form-label ps-4">modDate</label>
                    <div class="col">
                        <input type="text" class="form-control" id="modDate" name="modDate"
                               th:value="${dto.modDate}" readonly>
                    </div>
                </div>

                <!-- 5. list, modify ë²„íŠ¼ -->
                <div class="mt-3 d-flex" th:with="link=${pageRequestDTO.getLink()}">
                    <div><button type="button" id="list" class="btn btn-outline-danger opacity-50 listBtn">list</button></div>
                    <!-- í˜„ ê¸€ë²ˆí˜¸ì— ëŒ€í•œ í˜ì´ì§• ì •ë³´ë¥¼ ë„˜ê²¨ë°›ì•„ì„œ listìš”ì²­ì‹œ í˜ì´ì§• ì •ë³´ì™€ ê°™ì´ ìš”ì²­í•˜ë©´
                         í˜„ì¬ ê¸€ë²ˆí˜¸ê°€ í•´ë‹¹ë˜ëŠ” listí˜ì´ì§€ê°€ ì¶”ì¶œë¨ -->
                    <div class="ms-auto">
                        <button type="button" id="cancel" class="btn btn-outline-danger opacity-50 cancelBtn">cancel</button>
                        <button type="button" id="confirm" class="btn btn-outline-danger opacity-50 confirmBtn">confirm</button>
                    </div>

                </div>
            </form>
        </div>

    </div>

    <!-- ì²¨ë¶€íŒŒì¼ ê´€ë ¨ UI -->

    <!-- 1. ì²¨ë¶€íŒŒì¼ ì¸ë„¤ì¼ view --> <!-- addFilesBtn ì˜†ìœ¼ë¡œ ì˜®ê¹€ -->

    <!-- 2. ì²¨ë¶€íŒŒì¼ ì¶”ê°€ë¥¼ ìœ„í•œ ëª¨ë‹¬ì°½ -->
    <div class="modal modalUpload fade" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h1 class="modal-title fs-5">Upload Files</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3 row">
                        <label for="files" class="col-form-label ps-4">files</label>
                        <div class="col">
                            <input type="file" class="form-control" id="files" name="files" multiple>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary closeModalUpload" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary uploadBtn">Upload</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Axios ë¼ì´ë¸ŒëŸ¬ë¦¬ ì—°ê²° -->
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <!-- file upload ì²˜ë¦¬í•˜ëŠ” javascript ì—°ê²° -->
    <script src="/js/upload.js"></script>

</div>



<!-- í˜„ì¬ í˜ì´ì§€ì—ì„œë§Œ ì‚¬ìš©í•˜ëŠ” css ì •ì˜ -->
<style layout:fragment="mystyle" th:inline="css">
    #content{
        height:500px;
    }
    .col-form-label {
        width:110px;
    }
</style>

<!--/* í˜„ì¬ í˜ì´ì§€ì—ì„œë§Œ ì‚¬ìš©í•˜ëŠ” script ì •ì˜ */-->
<script layout:fragment="myscript" th:inline="javascript">



// ë¦¬ìŠ¤íŠ¸ ë²„íŠ¼
document.querySelector('.listBtn').addEventListener('click', function(e) {
    e.preventDefault();  // ê¸°ë³¸ ì´ë²¤íŠ¸ ì œê±°
    e.stopPropagation();  // ë²„ë¸”ë§(í˜„ì¬ ì´ë²¤íŠ¸ê°€ ë°œìƒí•œ ìš”ì†Œì˜ ìƒìœ„ ìš”ì†Œë“¤ì— ëŒ€í•´ì„œ ì´ë²¤íŠ¸ ê°ì§€ë˜ëŠ” í˜„ìƒ) ë°©ì§€

    location.href ="/board/list?"+[[${pageRequestDTO.getLink()}]];
})

// ì·¨ì†Œ ë²„íŠ¼
document.querySelector('.cancelBtn').addEventListener('click', function(e) {
    e.preventDefault();  // ê¸°ë³¸ ì´ë²¤íŠ¸ ì œê±°
    e.stopPropagation();  // ë²„ë¸”ë§(í˜„ì¬ ì´ë²¤íŠ¸ê°€ ë°œìƒí•œ ìš”ì†Œì˜ ìƒìœ„ ìš”ì†Œë“¤ì— ëŒ€í•´ì„œ ì´ë²¤íŠ¸ ê°ì§€ë˜ëŠ” í˜„ìƒ) ë°©ì§€

    location.href ="/board/read?bno="+[[${dto.bno}]]+"&"+[[${pageRequestDTO.getLink()}]];
})

// ìˆ˜ì • ë²„íŠ¼
document.querySelector('.confirmBtn').addEventListener('click', function(e) {
    e.preventDefault();  // ê¸°ë³¸ ì´ë²¤íŠ¸ ì œê±°
    e.stopPropagation();  // ë²„ë¸”ë§(í˜„ì¬ ì´ë²¤íŠ¸ê°€ ë°œìƒí•œ ìš”ì†Œì˜ ìƒìœ„ ìš”ì†Œë“¤ì— ëŒ€í•´ì„œ ì´ë²¤íŠ¸ ê°ì§€ë˜ëŠ” í˜„ìƒ) ë°©ì§€

    const link = [[${pageRequestDTO.getLink()}]];
    // const formObj = document.querySelector('form');  // form ì´ëŸ°ì‹ìœ¼ë¡œ íƒœê·¸ë¥¼ ì§ì ‘ ì°ìœ¼ë©´ ë‚˜ì¤‘ì— ì¶”ê°€, ìˆ˜ì • ì‘ì—…ì„ í•˜ë©´ì„œ ì¤‘ë³µë˜ì„œ ì˜¤ë¥˜ë‚  ê°€ëŠ¥ì„± ë†’ìŒ. ë¹„ì¶”ì²œ
    const formObj = document.querySelector('#modifyForm');
    const title = document.querySelector('#title');
    const content = document.querySelector('#content');
    const writer = document.querySelector('#writer');
    console.log("formObj", formObj);
    console.log(title.value);

    // ì„œë²„ë¡œ ë¶€í„° ì‘ë‹µë°›ì€ ë©”ì‹œì§€: dbì²˜ë¦¬í•œ í›„ ê²°ê³¼ ê°’ ì „ì†¡í•œ ê°ì²´
    const errors = [[${errors}]];
    console.log('errors',errors);

    let errMessage="";
    if (errors) {  // ì„œë²„ë¡œë¶€í„° ì‘ë‹µ ì—ëŸ¬ ë©”ì‹œì§€ ì²˜ë¦¬
        for (let i=0; i<errors.length; i++) {
            errMessage += `${errors[i].field}ì€ ${errors[i].code}\n`;

        }
        // ì›¹ë¸Œë¼ìš°ì €ì˜ ì„¸ì…˜ ê¸°ë¡ì„ ê´€ë¦¬í•˜ëŠ” JavaScriptì˜ History APIë©”ì„œë“œ
        // ë¸Œë¼ìš°ì €ì˜ ì„¸ì…˜ ê¸°ë¡ì„ ìˆ˜ì •í•˜ê±° ëŒ€ì²´í•˜ëŠ” ì—­í• 
        // history.replaceState({},null, null);

        alert(errMessage);
    }

    // ì—ëŸ¬ ì²´í¬

    if ((title.value.length < 1 || title.value == "")&&(content.value.length < 1 || content.value == "")) {
        alert("ì œëª©ê³¼ ë‚´ìš©ì´ ë¹„ì–´ìˆìŠµë‹ˆë‹¤!! ğŸ˜¡ğŸ˜¡");
        return;

    } else if (title.value.length < 1 || title.value == "") {
        alert("ì œëª©ì´ ë¹„ì–´ìˆìŠµë‹ˆë‹¤! ğŸ˜¡");
        return;

    } else if (content.value.length < 1 || content.value == "") {
        alert("ë‚´ìš©ì´ ë¹„ì–´ìˆìŠµë‹ˆë‹¤! ğŸ˜¡");
        return;

    }

    if (title.value.length < 3 || title.value.length > 100) {
        alert("3ì ì´ìƒ 100ì ì´ë‚´ì— ì œëª©ì„ ì¨ì£¼ì„¸ìš” bitch :b");
        title.focus();
        return;

    }

    if (content.value.length < 3 || content.value.length > 1000) {
        alert("3ì ì´ìƒ 1000ì ì´ë‚´ì— ê¸€ì„ ì¨ì£¼ì„¸ìš” bitch :b");
        content.focus();
        return;

    }

    // ì—ëŸ¬ ì²´í¬ í›„ ì •ìƒì¼ë•Œ ì²˜ë¦¬

    // self .location= `board/modify?${link}`;  // Getë°©ì‹(ìˆ˜ì •í˜ì´ì§€ ìš”ì²­)

    formObj.action = `/board/modify?${link}`;  // ì „ì†¡í•  ë§í¬ ì„¤ì •
    formObj.method = 'post';  // ì „ì†¡ ë°©ì‹ ì„¤ì •  // ì„¤ì • ì•ˆí•˜ë©´ ê¸°ë³¸ê°’ Get

    //const modDateBox = document.querySelector('#modDateBox');
    //modDateBox.innerHTML = '<>';

    // submit() : í¼ ì „ì†¡ ê¸°ëŠ¥   reset() : í¼ ë¦¬ì…‹ ê¸°ëŠ¥

    //console.log([[${dto}]]);
    formObj.submit();

    })


    // -------------------------------------------------- //
    // ê²Œì‹œê¸€ ìˆ˜ì • ì‘ì—…ì—ì„œ ì²¨ë¶€íŒŒì¼ ì‚­ì œ:
    // 1. ì´ë¯¸ì§€ë¥¼ í™”ë©´ì— ë³´ì´ì§€ ì•Šë„ë¡ ì œê±°
    // 2. ìˆ˜ì •í•˜ê¸° ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ ì—…ë¡œë“œëœ íŒŒì¼ ì‚­ì œ
    // -------------------------------------------------- //

    // 1. ì´ë¯¸ì§€ë¥¼ í™”ë©´ì— ë³´ì´ì§€ ì•Šë„ë¡ ì œê±°

    // ì‹¤ì œ ìˆ˜ì •ì‘ì—… ì§„í–‰ì‹œ ì‚´ì œë  íŒŒì¼ ëª©ë¡ ì €ì¥
    const removeFileList = [] // ë°°ì—´ ê°ì²´ ì„ ì–¸

    function removeFile(uuid, fileName, obj) {  // objëŠ” this(ì´ë²¤íŠ¸ê°€ ë°œìƒí•œ íƒœê·¸)
        console.log("uuid: ",uuid);
        console.log("fileName: ",fileName);
        console.log("obj: ",obj);  // í˜„ì¬ ë²„íŠ¼ ìš”ì†Œë¥¼ ì§€ì¹­

        if(!confirm("íŒŒì¼ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {  // ì·¨ì†Œë¥¼ ëˆ„ë¥´ë©´ return // í™•ì¸ ëˆ„ë¥´ë©´ ì‚­ì œ ì§„í–‰
            return;
        }

        // ì‚­ì œí•  íŒŒì¼ëª©ë¡ ì €ì¥
        removeFileList.push({uuid, fileName});


        // ìš”ì†Œ.closest('ì„ íƒìš”ì†Œ') : ìš”ì†Œê¸°ì¤€ìœ¼ë¡œ ìƒìœ„ ìš”ì†Œì¤‘ ê°€ì¥ ê°€ê¹Œìš´ ìš”ì†Œ ì„ íƒ
        // í˜„ì¬ ìš”ì†Œì—ì„œ ìƒìœ„(ë¶€ëª¨)ìš”ì†Œ ì°¾ì„ ê²½ìš° ì ìš©

        // ìë°”ìŠ¤í¬ë¦½íŠ¸ ìš”ì†Œì œê±° : remove() removeChild()
        // '.card' ìš”ì†Œì œê±° : ì´ë¯¸ì§€ í™”ë©´ì—ì„œ ì‚­ì œ
        const targetDiv = obj.closest('.card');
        targetDiv.remove()

        /*
        // íŒŒì¼ ì‚­ì œ ìš”ì²­ : axios()
        removeFileToServer(uuid, fileName)
        .then(remove => {
            // ì„œë²„ë¡œë¶€í„° ë°›ì€ ê°ì²´ì •ë³´: ì •ìƒì ìœ¼ë¡œ ì‚­ì œë˜ì—ˆìœ¼ë©´ HashMap í˜•ì‹ìœ¼ë¡œ ê°ì²´ ì „ë‹¬
            // HashMap('result': true)
            console.log(remove);  // HashMapê°ì²´ => remove JSONê°ì²´ë¡œ ë°›ìŒ
            console.log(remove.result);

            // ìë°”ìŠ¤í¬ë¦½íŠ¸ ìš”ì†Œì œì„œ: remove() removeChild()
            // '.card' ìš”ì†Œì œê±°: ì¸ë„¤ì¼ ì´ë¯¸ì§€ í™”ë©´ì—ì„œ ì‚­ì œ
            if(remove.result) targetDiv.remove();  // ì‚­ì œ ì„±ê³µí•˜ë©´ ì¸ë„¤ì¼ ì´ë¯¸ì§€ í™”ë©´ì—ì„œ ì‚­ì œ

        }).catch( e => {
            alert("ì˜¤ë¥˜ë‹¤ì˜¹~");
            console.log("ì˜¤ë¥˜ë‹¤ì˜¹~ ",e);
        });
        */

    } // end function
</script>

</html>

<!--

  ì‚¬ìš©ëª©ì  ìš”ì•½

    - í˜„ì¬ í˜ì´ì§€ì˜ URLì„ ìƒˆë¡œìš´ URLë¡œ ë³€ê²½
    - ì´ì— ë”°ë¼ í˜ì´ì§€ì˜ ìƒíƒœ ì •ë³´ë„ ì—…ë°ì´íŠ¸
    - ì‹¤ì œë¡œ í˜ì´ì§€ì˜ ë¦¬ë¡œë“œë‚˜ ë„¤íŠ¸ì›Œí¬ ìš”ì²­ì€ ë°œìƒí•˜ì§€ ì•ŠìŒ
    - ì‚¬ìš©ì ê²½í—˜ì„ ê°œì„ í•˜ë©´ì„œë„ í˜ì´ì§€ ê°„ ì „í™˜ì´ë‚˜ ìƒíƒœ ê´€ë¦¬ë¥¼ ììœ ë¡­ê²Œ ì œì–´

    ex(
    // í˜„ì¬ URL: http://example.com/page1
    const newState = { data: 'some data' };
    // í˜„ì¬ URLê³¼ ìƒíƒœë¥¼ ìƒˆë¡œìš´ URLê³¼ ìƒíƒœë¡œ ë³€ê²½
    history.replaceState(newState, '', 'http://example.com/page2');

-->